# 计算机网络

## 第一章 概要

### 基本概念

**互联网**（Internet）特指Internet，起源于美国，现已发展成为世界上最大的、覆盖全球的**计算机网络**。

**计算机网络**简称为**网络**，是由若干**结点（node）**和连接这些结点的**链路（link）**组成。

**互连网**（internetwork或internet）通过**路由器**把网络互连起来，这样形成了覆盖范围更大的网络，称之为互连网，**网络连接成的网络**。 

**结点**（node）在计算机网络中表示为一个一个的设备，而不是"节点"。

**主机**（host）实际上是用户的计算机设备，在网络中统称为主机，作用是提供资源或获取资源的设备。

**万维网WWW**（World Wide Web）有利于资源传播。



### 互联网基础结构发展的三个阶段

**第一阶段**：从单个网络ARPANET（美国军事使用）向互联网发展的过程。

**第二阶段**：建成了三级结构的互联网，主干网——地区网——园区网（校园网、企业网）。

**第三阶段**：逐渐形成了多层次ISP结构的互联网。

ISP：互联网服务提供者，如中国电信，为我们这些用户提供服务。



### 网络分类

从网路的作用范围进行分类

- **广域网WAN**（Wide Area Network）：作用范围几十到几千公里。
- **城域网MAN**（Metropolitan Area Network）：作用范围5-50公里。
- **局域网LAN**（Local Area Network）:局限在较小的范围（如1公里左右）。
- **个人区域网PAN**（Personal Area Network）：范围很小，大约10米左右。

从网络的使用者进行分类

- **公用网**，也称公众网，按规定缴费的人都可以使用的网络。
- **专用网**，为特殊业务工作的需要而建造的网络。

用来把用户接入到互联网的网络叫**接入网**（Access Network），它又称本地接入网或居民接入网，起到**桥梁**作用。既不属于核心部分，也不属于边缘部分。

### 互联网组成

互联网两大特征：连通性，资源共享。

从互联网的工作方式上看，可以划分为两大块：

（1）**边缘部分**：由所有连接在互联网上的主机组成，所有的用户实际上就构成了边缘部分，作用是数据通信和资源共享，也就是所有的资源都是处在边缘的用户提供的，所以也称边缘部分称为**资源子网**。

（2）**核心部分**：由大量网络和连接这些网络的路由器组成，能为边缘部分提供服务（提供连通性和交换），所以也被称为**通信子网**。

处于边缘部分的主机又被称为**端系统**。

在网络核心部分起特殊作用的是**路由器**（router），能连接不同网络，是功能特殊的主机。



#### 1.边缘部分端系统通信（交换资源）的两种方式

端系统之间通信的含义（主机A和主机B进行通信实际上是指）：“运行在主机A的某个程序（进程）和运行在主机B上的另一个程序（进程）进行通信”，简称为**计算机之间通信**。

这两个进程进行通信（交换资源）的方式分为两大类：

1.**客户-服务器方式**（C/S方式），即Client/Server方式。

​	客户和服务器都是指通信中所涉及的两个应用进程，客户是服务的请求方，服务器是服务的提供方。客户必须知道**服务器的地址**才能请求服务。

​	客户和服务器是双向的，都可以接收发送数据。

​	C/S方式是互联网上资源子网中提供资源的设备相互工作的基本状态，绝大多数设备之间都是采用CS的方式相互工作。

2.**对等方式**（P2P方式），即Peer-to-Peer方式。

​	指两个主机在通信时并不区分哪一个是请求方还是服务方。进行平等的、对等的连接通信，需要专门的P2P软件，如bt下载，电驴；但可能会涉及版权问题，P2P软件相对来说比较少。

​	从本质上来看仍然是使用客户-服务器方式，只是对等连接中**每一个主机即使服务器也是客户**，身份不固定。



#### 2.核心部分进行传输数据的方式

路由器是实现**分组交换**的关键构建，其任务是**转发**收到的分组，这是网络核心部分最重要的功能。

要理解分组交换，先理解**电路交换**。每一部电话都直接连接到交换机上，而交换机使用交换的方法，让电话用户彼此之间可以很方便的通信。

​	**电路交换的特点**：

- 电路交换必定是**面向连接**的。
- 电路交换分为三个阶段：建立连接——通信——释放连接。只要不释放资源，始终占用端到端的通信资源，所以传输非常可靠，**可靠性高**

​	**电路交换的缺点**（为什么不选电路交换作为构建网络的基础）：

​		因为计算机数据具有突发性，传输数据不稳定，通信线路的利用率很低，所以采用分组交换方式。

​	**分组交换的特点**：

​		分组交换则采用了**存储转发**的技术。在发送端，先把较长的报文**划分成较短的、固定长度的数据段**。

​		每一个分组在互联网中**独立地选择传输路径**。		

​		在每一个数据段前面添加上**首部**构成分组（packet）

<img src="C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210126214152304.png" alt="image-20210126214152304"  />转变成

![image-20210126214040739](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210126214040739.png)



分组转发的转发是**存储转发**过程，主要设备是靠路由器。

在路由器中的输入和输出端口之间**没有之间连线**。

**路由器处理分组的过程**是：

- 把收到的分组先**放入缓存（暂时存储）**。
- **查找转发表**，找出到某个目的地址应该从哪个端口转发。
- 把分组送到适当的端口**转发**出去。

也就是说路由器工作的对象是**分组**，工作的方式是**存储转发**。



**分组交换的优点**（相对于电路交换而言）

| 优点 | 所采用的手段                                                 |
| ---- | ------------------------------------------------------------ |
| 高效 | 在分组传输的过程中动态分配传输带宽，对通信链路是逐段占用。   |
| 灵活 | 为每一个分组独立地选择最合适的转发路由                       |
| 迅速 | 以分组作为传送单位，可以不先建立连接就能向其他主机发送分组   |
| 可靠 | 保证可靠性的网络协议；分布式多路由的交换网，使网络有很好的生存性 |

**分组交换所带来的问题**

- 分组交换的存储转发在存储的过程中需要**排队**（等待），这会造成一定的**时延**。
- 分组必须携带的首部（里面有必不可少的控制信息）也造成了一定的**开销**。



在更早的时候，电报通信也采用了基于存储转发原理的**报文交换**；注意比较三种交换方式。



### 计算机网络的性能

#### 1.计算机网络的性能指标

**速率**，指的是数据的传送速率，也称数据率或比特率。单位是bit/s,或kbit/s、Mbit/s、Gbit/s等。单位转化以1000位标准，而不是1024。速率往往是指额定速率或标称速率，非实际运行速率。

**带宽**，在计算机网络中，带宽用来表示网路中某个信道传输数据的能力。表示在单位时间内网络中某信道所能通过的**最高数据率**。单位也是bit/s。

![image-20210127152938419](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210127152938419.png)

**吞吐量**，表示在单位时间内通过某个网络（或信道、接口）的数据量。

**时延**，是指数据（一个分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间。网路中的时延由以下几个不同的部分组成：（1）发送时延，（2）传播时延，（3）处理时延，（4）排队时延。

**时延带宽积**，= 传播时延 * 带宽。

**往返时间RTT**,表示从发送方发送数据开始，到发送放收到来自接收方的确认，总共经历的时间。

**利用率**，分为信道利用率和网络利用率。信道利用率指某信道有百分之几的时间是有数据通过的（被利用的），完全空闲的信道的利用率是0。网络利用率则是全网络的信道利用率的加权平均值。信道利用率并非越高越好。当某信道的利用率增大时，该信道引起的时延也就迅速增加。

![image-20210127155050453](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210127155050453.png)

![image-20210127155219614](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210127155219614.png)

#### 2.计算机网络的非性能指标

费用、质量、标准化、可靠性、可扩展性和可升级性、易于管理和维护



### 计算机网络的体系结构

最早的开放系统互连参考模型**OSI/RM**，共七层，但实现起来效果不好，有些部分过于理论。

之后使用了**TCP/IP**标准，虽然不是表面国际标准，但是是事实上的国际标准，共四层。

之后采取了折中的办法，即综合OSI和TCP/IP的优点，采用了只有五层协议的体系结构。

- 应用层
- 运输层
- 网络层
- 数据链路层
- 物理层



**实体**，表示任何可能发送或接受信息的硬件或软件进程。

**网络协议**（network protocol），简称协议，是为进行网络中的数据交换而建立的规则、标准或约定。

协议的三个组成要素：

- **语法**：数据与控制信息的结构或格式。
- **语义**：需要发出何种控制信息，完成何种动作以及做出何种响应。
- **同步**（时序）：事件实现顺序的详细说明。

各层完成的主要功能：

- 差错控制
- 流量控制
- 分段和重装
- 复用和分用
- 连接建立和释放



## 第二章 物理层

### 常用术语

![image-20210209134502133](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209134502133.png)

### 物理层的基本概念

物理层考虑的是**怎样才能连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体**。

物理层的作用是要尽可能地**屏蔽**掉不同传输媒体和通信手段的差异。

用于物理层的协议也常称为物理层**规程**。



### 物理层的主要任务

主要任务：确定与传输媒体的接口的一些特性。

- 机械特性：指明接口所用接线器的形状和尺寸、引线数目和排列、固定和锁定装置等。如我们常说的双绞线”水晶头“是按照标准RJ-45生产的。
- 电气特性：指明出在接口电缆的各条线上出现的电压的范围。
- 功能特性：指明某条线上出现的某一电平的电压表示何种意义。
- 过程特性：指明对于不同功能的各种可能事件的出现顺序。



### 关于信道的几个基本概念

![image-20210209134550421](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209134550421.png)

（信息）

![image-20210209134827863](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209134827863.png)



### 调制分为两大类

![image-20210209135218419](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209135218419.png)



**基带调制的方法有：**

归零制、不归零制、曼彻斯特、差分曼彻斯特

**带通调制的方法有：**

调幅（AM）、调频（FM）、调相（PM）

![image-20210209140816729](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209140816729.png)



从概念上来讲，限制码元在信道上的传输速度的因素有以下两个：

- 信道能够通过的频率范围
- 信噪比

**香农公式**

![image-20210209144152860](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209144152860.png)

![image-20210209144234792](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209144234792.png)

还有种方法提高信息的传输速率：**用编码的方法让每一个码元携带更多比特的信息量**。



### 物理层下面的传输媒体

分为两大类：导引型传输媒体，非导引型传输媒体。

#### 1.导引型传输媒体

**双绞线**：分为屏蔽双绞线STP和无屏蔽双绞线UTP。

**同轴电缆**：50欧同轴电缆，75欧同轴电缆（以前插电视的，中间圆柱两边空心）。

**光缆**：光纤是光纤通信的传输媒体，有**多模光纤和单模光纤**，常用。

#### 2.非导引型传输媒体

长波、中波、**短波通信、微波**

![image-20210209155113114](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209155113114.png)



### 信道复用技术

技术有：频分复用、时分复用和统计时分复用、波分复用、码分复用

**频分复用**：

![image-20210209160522040](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209160522040.png)

**时分复用**：

![image-20210209160551470](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209160551470.png)

**统计时分复用**：时分复用的优化

![image-20210209160627299](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209160627299.png)

**波分复用**:就是光的频分复用

![image-20210209160650568](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209160650568.png)**码分复用**(CDM)：

常用的名词是**码分多址**CDMA。

![image-20210209175416707](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209175416707.png)

![image-20210209175526447](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209175526447.png)

![image-20210209175451124](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209175451124.png)

![image-20210209175552305](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209175552305.png)

**A:1 B:0 C:无 D:1**



## 第三章 数据链路层

数据链路层使用的信道**主要有两种类型**：

- 点对点信道：这种信道使用一对一的点对点通信方式。
- 广播信道：这种信道使用一对多的广播信道方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。



**链路(link)**是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。

**数据链路（data link）**除了物理线路外，还必须有通信协议来控制这些数据的传输。

**帧**：在数据链路层中把一个封装好的数据分组称为帧。



### 三个基本问题

数据链路层协议有许多种，但有三个基本问题则是共同的。这三个基本问题是：

（1）封装成帧（2）透明传输（3）差错控制

在这里的透明意思是，指不管这个东西有没有发生，有没有存在，都认为它是不存在的。



**封装成帧**

![image-20210209192933022](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209192933022.png)

![image-20210209194014379](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209194014379.png)



**透明传输**

如果数据中的某个字节的二进制代码恰好和SOH或EOT一样，数据链路层就会错误地“找到帧的边界”。

![image-20210209193513757](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209193513757.png)



**差错检测**

![image-20210209194213940](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209194213940.png)

检错比纠错更容易实现，更广泛使用。

**循环冗余校验CRC**的检错技术

![image-20210209194434047](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210209194434047.png)

![image-20210213132723105](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213132723105.png)

在数据链路层使用CRC检验，能够实现无比特差错的传输，但这不是可靠传输。

本章介绍的数据链路层协议都不是可靠传输的协议。

什么叫可靠传输？不重复、不丢失、不失序。



### 点对点协议PPP

对于点对点的链路，目前使用得最广泛的数据链路层协议是点对点协议PPP

![image-20210213133131461](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213133131461.png)

![image-20210213133150681](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213133150681.png)

![image-20210213133213295](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213133213295.png)

**PPP协议的组成**

![image-20210213133235197](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213133235197.png)

PPP协议的帧格式

![image-20210213133328666](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213133328666.png)

![image-20210213133410240](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213133410240.png)

**比特填充**

![image-20210213133935310](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213133935310.png)





### 使用广播信道的数据链路层

![image-20210213141607312](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213141607312.png)

为了通信的简便，以太网采取了两种重要的措施：

1. 采用较为灵活的无连接的工作方式。
2. 以太网发送的数据都使用曼彻斯特编码。

![image-20210213141905267](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213141905267.png)



![image-20210213135300613](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213135300613.png)

![image-20210213135421932](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213135421932.png)![image-20210213135850222](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213135850222.png)

![image-20210213135821431](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213135821431.png)

![image-20210213140144265](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213140144265.png)



**CSMD/CD协议**

![image-20210213142351597](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213142351597.png)

![image-20210213142705473](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213142705473.png)

![image-20210213142734953](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213142734953.png)

![image-20210213143436637](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213143436637.png)

![image-20210213145347543](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213145347543.png)

![image-20210213143642697](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213143642697.png)

![image-20210213145641188](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213145641188.png)

![image-20210213150147384](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213150147384.png)

![image-20210213150205781](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213150205781.png)

![image-20210213150229638](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213150229638.png)

![image-20210213150306058](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210213150306058.png)

先听后发、边听边发、冲突停止、延迟重发。



集线器

![image-20210218155733439](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218155733439.png)

![image-20210218155747673](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218155747673.png)

![image-20210218155844802](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218155844802.png)

![image-20210218155853712](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218155853712.png)

![image-20210218155910324](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218155910324.png)

![image-20210218155921253](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218155921253.png)



### 以太网的MAC层

MAC层的硬件地址

![image-20210218160022050](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218160022050.png)

![image-20210218160107288](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218160107288.png)

**广播：48位全是1（12个F）**



![image-20210218160216681](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218160216681.png)

![image-20210218160329942](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218160329942.png)

1500 + 18 = 1518 MAC帧最长1518字节

为什么IP数据报最短长度是46字节？



![image-20210218160723695](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218160723695.png)



**扩展的以太网**

![image-20210218162005338](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218162005338.png)

![image-20210218162209576](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218162209576.png)

![image-20210218162554978](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218162554978.png)

所以进一步的修改

### 以太网交换机

![image-20210218163621538](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218163621538.png)

![image-20210218163932757](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218163932757.png)

![image-20210218164204028](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218164204028.png)

**交换机的自学习**

![image-20210218165855728](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218165855728.png)

**广播风暴**

![image-20210218170301829](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218170301829.png)

解决这总环路的方法：生成树协议

![image-20210218170443351](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218170443351.png)

​	

### 虚拟局域网

![image-20210218170907688](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218170907688.png)

![image-20210218171002325](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218171002325.png)

一个广播只能发生在一个虚拟局域网当中，在之前讲的帧头前面还要加一个虚拟局域网的标识段。

![image-20210218172817326](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218172817326.png)



![image-20210218172922433](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218172922433.png)

![image-20210218173037831](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210218173037831.png)

## 第四章 网络层

网络层不需要确保可靠传输。

这层研究：网络层到底是怎么尽最大努力交付的。

![image-20210219220953657](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210219220953657.png)

![image-20210219221315283](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210219221315283.png)



### 网际协议IP

![image-20210220142857830](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220142857830.png)

![image-20210220142941566](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220142941566.png)



数据链路层的寻址方式是MAC地址，网络层的寻址方式是**IP地址**。

![image-20210220144117417](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220144117417.png)

![image-20210220144216233](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220144216233.png)

![image-20210220144321004](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220144321004.png)



**分类的IP地址**

![image-20210220144447395](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220144447395.png)

A、B、C、D、E五类

![image-20210220144530498](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220144530498.png)

![image-20210220144538957](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220144538957.png)

A、B、C是可以给用户使用的。D类是多播地址、E类作为特殊的保留使用。

![image-20210220145532039](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220145532039.png)

![image-20210220145651597](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220145651597.png)

![image-20210220150251783](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220150251783.png)

![image-20210220150335305](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220150335305.png)

![image-20210220150533940](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220150533940.png)

![image-20210220151322162](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220151322162.png)

![image-20210220151928048](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220151928048.png)

为什么链路层知道要是HA1到HA3而不是HA2、HA4等等地址呢？靠地址解析协议ARP

![image-20210220152026244](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220152026244.png)

![image-20210220152507829](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220152507829.png)

![image-20210220153254414](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220153254414.png)

![image-20210220153218465](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220153218465.png)

![image-20210220153444384](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220153444384.png)

![image-20210220153618845](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220153618845.png)

![image-20210220154758363](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220154758363.png)



为什么要设置IP地址，不一直用MAC地址？

![image-20210220155013040](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210220155013040.png)



**IP数据报的格式**

![image-20210221143851364](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221143851364.png)

![image-20210221144127877](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221144127877.png)

![image-20210221144426776](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221144426776.png)

![image-20210221144728589](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221144728589.png)

![image-20210221145120715](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221145120715.png)

![image-20210221151000605](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221151000605.png)	

![image-20210221151049407](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221151049407.png)

![image-20210221151223906](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221151223906.png)



**IP层转发分组的流程**

![image-20210221152100581](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221152100581.png)

![](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221152356563.png)

![image-20210221152710704](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221152710704.png)

报告转发分组与ICMP有关



**划分子网和构造超网**

![image-20210221154143355](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221154143355.png)

![image-20210221154200750](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221154200750.png)

![image-20210221154637641](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221154637641.png)

![image-20210221155111866](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210221155111866.png)

子网号不能全是0或全是1



**CIDR**

![image-20210228112327405](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228112327405.png)

![image-20210228112437837](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228112437837.png)

![image-20210228112734099](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228112734099.png)

![image-20210228113049366](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228113049366.png)





### 网际控制报文协议ICMP

![image-20210228150318706](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228150318706.png)

![image-20210228150428092](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228150428092.png)

![image-20210228150519532](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228150519532.png)

![image-20210228150620800](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228150620800.png)

![image-20210228151358067](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228151358067.png)

![image-20210228151441543](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228151441543.png)

![image-20210228151623022](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228151623022.png)

![image-20210228151925104](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228151925104.png)





### 路由协议

![image-20210228142636947](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228142636947.png)

![image-20210228142926887](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228142926887.png)

![image-20210228142935401](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228142935401.png)

![image-20210228143125105](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210228143125105.png)



### IPV6

![image-20210301104530414](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301104530414.png)

![image-20210301104619377](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301104619377.png)

![image-20210301104645533](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301104645533.png)

![image-20210301104749352](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301104749352.png)

![image-20210301105015083](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301105015083.png)

![image-20210301105103115](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301105103115.png)

![image-20210301105640717](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301105640717.png)

![image-20210301105707192](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301105707192.png)

![image-20210301105538267](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301105538267.png)

![image-20210301105733451](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301105733451.png)



### IP多播

![image-20210301110334102](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301110334102.png)通过硬件多播，源主机只发一次。

网际组管理协议IGMP，多播路由选择协议。



### 虚拟专用网VPN和网络地址转换NAT

![image-20210301110930480](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301110930480.png)

![image-20210301111056587](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301111056587.png)



### 多协议标记交换MPLS

提高网络层转发效率

![image-20210301111254105](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301111254105.png)

![image-20210301111342513](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301111342513.png)

## 第五章 传（运）输层

应用进程之间的逻辑通信

![image-20210301235318091](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301235318091.png)

![image-20210301235433832](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301235433832.png)

![image-20210301235840937](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301235840937.png)

![image-20210301235949454](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210301235949454.png)

![image-20210302000247916](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302000247916.png)

![image-20210302000412553](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302000412553.png)

![image-20210302000533768](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302000533768.png)

![image-20210302000758271](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302000758271.png)



### 端口

![image-20210302001155640](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302001155640.png)

![image-20210302001419472](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302001419472.png)

![image-20210302001606876](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302001606876.png)

![image-20210302001700206](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302001700206.png)

![image-20210302001951048](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302001951048.png)



### 用户数据报协议UDP

![image-20210302000853869](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302000853869.png)

![image-20210302002316551](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302002316551.png)

![image-20210302002415304](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302002415304.png)

![image-20210302002632538](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302002632538.png)

![image-20210302002729055](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302002729055.png)

![image-20210302002856157](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302002856157.png)d

计算伪首部：反码求和

### 传输控制协议TCP

![image-20210302001009126](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302001009126.png)

![image-20210302003417997](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302003417997.png)

![image-20210302003722982](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302003722982.png)

![image-20210302003845792](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302003845792.png)

![image-20210302004230814](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302004230814.png)

![image-20210302152424841](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302152424841.png)

![image-20210302152541241](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302152541241.png)

![image-20210302152602084](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302152602084.png)

![image-20210302152747947](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302152747947.png)

![image-20210302152940959](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302152940959.png)

![image-20210302153118181](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302153118181.png)

![image-20210302153820203](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302153820203.png)

![image-20210302153856350](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302153856350.png)

![image-20210302153955115](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302153955115.png)

![image-20210302154051039](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302154051039.png)

![image-20210302154134588](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302154134588.png)

也称为滑动窗口协议

![image-20210302154508948](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302154508948.png)

![image-20210302154605983](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302154605983.png)

![image-20210302154747827](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302154747827.png)

![image-20210302154826564](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302154826564.png)

![image-20210302155045566](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302155045566.png)

![image-20210302155121977](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302155121977.png)

![image-20210302160353706](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302160353706.png)

![image-20210302161602388](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302161602388.png)

![image-20210302161657908](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302161657908.png)

![image-20210302161842116](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302161842116.png)

![image-20210302161855429](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302161855429.png)

![image-20210302162102743](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302162102743.png)

![image-20210302162146874](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302162146874.png)

很少用选择确认

![image-20210302163351010](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302163351010.png)

![image-20210302163450604](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302163450604.png)

![image-20210302164024818](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302164024818.png)

![image-20210302164012109](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302164012109.png)

![image-20210302164226260](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302164226260.png)

![image-20210302164428269](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302164428269.png)

![image-20210302164549279](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302164549279.png)

![image-20210302164625468](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302164625468.png)

![image-20210302165032110](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302165032110.png)

![image-20210302165303204](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302165303204.png)

![image-20210302165347978](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302165347978.png)

![image-20210302165855639](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210302165855639.png)

TCP拥塞控制方法

![image-20210303103300256](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303103300256.png)

![image-20210303103911014](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303103911014.png)

![image-20210303104000134](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303104000134.png)

![image-20210303104318331](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303104318331.png)

刚刚两种拥塞的情况，第一种值采用前两个方法处理，第二种四个方法都用来处理。

**慢开始与拥塞避免**

![image-20210303104500532](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303104500532.png)

![image-20210303104521571](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303104521571.png)

![image-20210303105258729](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303105258729.png)

![image-20210303105345554](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303105345554.png)

![image-20210303105602462](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303105602462.png)

![image-20210303130025627](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303130025627.png)

![image-20210303130037686](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303130037686.png)

![image-20210303130050428](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303130050428.png)

![image-20210303130221873](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303130221873.png)

![image-20210303130311717](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303130311717.png)

因为TCP是全双工，如果只有前两次握手，只保证了A能给B发数据，不能保证A能收到B的数据。两个往返，分别都有发送和确定的过程。

![image-20210303130821199](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303130821199.png)

![image-20210303130928843](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303130928843.png)

![image-20210303131231505](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303131231505.png)

![image-20210303131430222](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303131430222.png)

![image-20210303131724769](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303131724769.png)

![image-20210303132311520](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303132311520.png)

## 第六章 应用层

![image-20210303132851175](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303132851175.png)

### 域名系统DNS

端口53，即使用UDP，也使用TCP

![image-20210303181408296](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303181408296.png)

![image-20210303181719364](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303181719364.png)

![image-20210303182022695](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303182022695.png)

![image-20210303182213394](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303182213394.png)

![image-20210303182229865](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303182229865.png)

![image-20210303182730235](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303182730235.png)

![image-20210303184302177](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303184302177.png)

![image-20210303194758563](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303194758563.png)

![](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303194717347.png)

![image-20210303194809216](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303194809216.png)

![image-20210303194842889](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303194842889.png)

![image-20210303195107178](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303195107178.png)

![image-20210303195344907](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303195344907.png)

![image-20210303195550264](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303195550264.png)

### 文件传送协议FTP

基于TCP，端口号21建立连接，用20号端口实现数据传输。

![image-20210303195759552](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303195759552.png)

![image-20210303200132607](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303200132607.png)

### 简单文件传送协议TFTP

![image-20210303200548366](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303200548366.png)

![image-20210303201117980](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210303201117980.png)

### 远程终端协议TELNET

23号端口

![image-20210304145222222](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304145222222.png)

![image-20210304145506928](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304145506928.png)

![image-20210304145539213](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304145539213.png)



### 万维网WWW

![image-20210304145759763](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304145759763.png)

![image-20210304145936655](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304145936655.png)

![image-20210304150026306](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150026306.png)

![image-20210304150411528](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150411528.png)

![image-20210304150440817](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150440817.png)

![image-20210304150453354](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150453354.png)

![image-20210304150505241](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150505241.png)

![image-20210304150541915](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150541915.png)

![image-20210304150558327](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150558327.png)

http 端口80

![image-20210304150931246](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150931246.png)

![image-20210304150944926](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304150944926.png)

![image-20210304151011981](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304151011981.png)

![image-20210304151401277](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304151401277.png)

![image-20210304151715730](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304151715730.png)

![image-20210304151802764](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304151802764.png)

HTTPS 443端口

![image-20210304152128728](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304152128728.png)

![image-20210304152541548](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304152541548.png)

![image-20210304152649730](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304152649730.png)

![image-20210304152701277](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304152701277.png)

![image-20210304153206731](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304153206731.png)

![image-20210304153312596](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304153312596.png)

![image-20210304153656954](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304153656954.png)

![image-20210304153832984](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304153832984.png)

### 电子邮件

![image-20210304154450128](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304154450128.png)

![image-20210304154612278](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304154612278.png)

![image-20210304155010856](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304155010856.png)

![image-20210304155210891](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304155210891.png)



### 动态主机配置协议DHCP

![image-20210304160212863](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304160212863.png)



### 简单网络管理协议SNMP

![image-20210304160801899](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304160801899.png)

![image-20210304160918728](C:\Users\TR\AppData\Roaming\Typora\typora-user-images\image-20210304160918728.png)



## 面试相关题目

### TCP为什么要三次握手？

参考链接：https://www.zhihu.com/question/24853633

`表因`：为了防止已失效的连接请求报文突然又传送到了服务端，因而产生错误

> 谢希仁版《计算机网络》中的例子是这样的，“已失效的连接请求报文段” 的产生在这样一种情况下：client 发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达 server。本来这是一个早已失效的报文段。但 server 收到此失效的连接请求报文段后，就误认为是 client 再次发出的一个新的连接请求。于是就向 client 发出确认报文段，同意建立连接。假设不采用 “三次握手”，那么只要 server 发出确认，新的连接就建立了。由于现在 client 并没有发出建立连接的请求，因此不会理睬 server 的确认，也不会向 server 发送数据。但 server 却以为新的运输连接已经建立，并一直等待 client 发来数据。这样，server 的很多资源就白白浪费掉了。采用 “三次握手” 的办法可以防止上述现象发生。例如刚才那种情况，client 不会向 server 的确认发出确认。server 由于收不到确认，就知道 client 并没有要求建立连接。



TCP 需要 seq 序列号来做可靠重传或接收，而避免连接复用时无法分辨出 seq 是延迟或者是旧链接的 seq，因此需要三次握手来约定**确定双方的 ISN（初始 seq 序列号）**。

两次不够用，四次重复浪费资源。



还可以说：因为TCP是全双工，如果只有前两次握手，只保证了A能给B发数据，不能保证A能收到B的数据。两个往返，分别都有发送和确定的过程。



三次握手的原则设计是防止旧复用链接的初始化导致问题，为了解决此问题，我们设计了`reset`这个特别的控制信号来处理。

如果接收中的 TCP 在一个未同步状态如 `SYN-SENT, SYN-RECEIVED`，它会返回 `reset` 给对方，对方又变成listen状态。