# 位运算

### 什么是位运算？

**位运算是在数字底层（即表示数字的 32 个数位）进行运算的。**由于位运算是低级的运算操作，所以速度往往也是最快的（相对其它运算如加减乘除来说），并且借助位运算有时我们还能实现更简单的程序逻辑,缺点是很不直观，许多场合不能够使用。

ECMAScript 整数有两种类型，即有符号整数（允许用正数和负数）和无符号整数（只允许用正数）。在 ECMAScript 中，所有整数字面量默认都是有符号整数，这意味着什么呢？

有符号整数使用 31 位表示整数的数值，用第 32 位表示整数的符号，0 表示正数，1 表示负数。数值范围从 -2147483648 到 2147483647。

> **有符号整数通常用补码来表示和存储**，补码具有如下特征：
>
> 正整数的补码与原码相同；负整数的补码为其原码除符号位外的所有位取反后加 1。
>
> 可以将减法运算转化为补码的加法运算来实现。
>
> 符号位与数值位可以一起参与运算。
>
> **原码、反码和补码**
>
> 原码就是符号位加上真值的绝对值, 即用第一位表示符号, 其余位表示值.
>
> 反码的表示方法是:
>
> - 正数的反码是其本身
> - 负数的反码是在其原码的基础上, **符号位不变**，其余各个位取反.
>
> 补码的表示方法是:
>
> - 正数的补码就是其本身
> - 负数的补码是在其原码的基础上, 符号位不变, 其余各位取反, 最后+1. (即在反码的基础上+1)
>
>  **为什么要使用原码、反码、补码？**
>
> 简单的来说，如果只使用原码进行基础运算（加减），电路设计会较为复杂。为了使计算机设计更简便，计算时将符号位参与运算，并且只保留加法的方法，从而设计了反码。
>
> 而后续补码的出现，不仅仅修复了0的符号以及存在两个编码的问题，而且还能够多表示一个最低数这就是为什么8位二进制，使用原码或反码表示的范围为[-127, +127]，而使用补码表示的范围为[-128, 127]。

### 编程中使用的位运算相关符

**按位或 |**

0 | 0  = 0

1 | 0 = 1

0 | 1 = 1

1 | 1 = 1

举例：9 | 3 = 11

应用：

1.取整 number | 0

2.边界判断（一些写法上比if简单） 还比如我们有一系列控制开关，通过 a | b | c的形式要比 '{a: true, b: true, c: true}' 简单的多。

**按位与 &**

1 & 1 = 1

0 & 0 = 0

1 & 0 = 0

0 & 1= 0

举例：9 & 3 = 1

应用：

1.在<< 1后，可以只看成只进位相加（重要）

2.判断奇偶 number & 1

**按位异或 ^**

对于每一个比特位，当两个操作数相应的比特位有且只有一个1时，结果为1，否则为0。

1 & 1 = 0

0 & 0 = 0

1 & 0 = 1

0 & 1= 1

举例：9 ^ 3 = 10

应用：

1.其运算法则相当于不带进位的二进制加法

**按位非～**

对每一个比特位执行非（NOT）操作。NOT a 结果为 a 的反转（即反码）。

对任一数值 x 进行按位非操作的结果为 -(x + 1)

负数存储采用的形式是二进制补码。计算数字二进制补码的步骤有三步：

1.确定该数字的非负版本的二进制表示（例如，要计算 -18的二进制补码，首先要确定 18 的二进制表示）

2.求得二进制反码，即要把 0 替换为 1，把 1 替换为 0（相当于～操作）

3.在二进制反码上加 1

我们可以看到一个数a取负相当于 ~a + 1, 即 -a = ~a + 1, 因此～a = -(a + 1)

应用：

1.取整 ~~(-5.88)

2.判断数组中某项是否存在 ~arr.indexOf(item)

**按位移动操作符**

左移 <<

该操作符会将第一个操作数向左移动指定的位数。向左被移出的位被丢弃，右侧用 0 补充。

对任一数值 x 进行左移n, 相当于十进制里的乘以10的倍数，在这儿是指x * 2^n

应用：rgb转16进制颜色

带符号右移 >>

该操作符会将第一个操作数向右移动指定的位数。向右被移出的位被丢弃，拷贝最左侧的位以填充左侧。由于新的最左侧的位总是和以前相同，符号位没有被改变。所以被称作“符号传播”。（相当于正数右移高位补0，负数右移高位补1）

应用：16进制颜色转rgb

无符号右移 >>>

该操作符会将第一个操作数向右移动指定的位数。向右被移出的位被丢弃，左侧用0填充。因为符号位变成了 0，所以结果总是非负的。（译注：即便右移 0 个比特，结果也是非负的。）

参考文章

-  [深入研究js中的位运算及用法](https://www.cnblogs.com/mopagunda/p/11221928.html)

