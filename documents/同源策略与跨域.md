# 同源策略

## 浏览器的同源策略

**同源策略**是一个重要的安全策略，它用于限制一个源（origin）的文档或者它加载的脚本如何能与另一个源的资源进行交互。它能帮助阻隔恶意文档，减少可能被攻击的媒介

## 同源的定义

如果2个URL的protocol（协议）、port（域名或叫主机，如果有指定的话）和host（端口）都相同的话，则这两个URL是同源。这个方案也被称为“协议/主机/端口元组”，或者直接是 “元组”。

## IE 中的特例

Internet Explorer 的同源策略有两个主要的差异点：

- **授信范围**（Trust Zones）：两个相互之间高度互信的域名，如公司域名（corporate domains），则不受同源策略限制。
- **端口**：IE 未将端口号纳入到同源策略的检查中，因此 `https://company.com:81/index.html` 和 `https://company.com/index.html` 属于同源并且不受任何限制。

这些差异点是不规范的，其它浏览器也未做出支持，但会助于开发基于window RT IE的应用程序。



# 跨域

## 什么是跨域

受前面所讲的浏览器同源策略的影响，不是同源的脚本不能操作其他源下面的对象。想要操作另一个源下的对象是就需要跨域。

##  跨域的实现形式

**1.降域 document.domain**

domain 属性可返回下载当前文档的服务器域名。

同源策略认为域和子域属于不同的域，如：

​	child1.a.com 与 a.com，

​	child1.a.com 与 child2.a.com，

​	xxx.child1.a.com 与 child1.a.com
两两不同源，可以通过设置 document.damain='a.com'，浏览器就会认为它们都是同一个源。想要实现以上任意

两个页面之间的通信，两个页面必须都设置documen.damain='a.com'。

此方式的特点：

​	1.只能在父域名与子域名之间使用，且将 xxx.child1.a.com域名设置为a.com后，不能再设置成child1.a.com
​	2.存在安全性问题，当一个站点被攻击后，另一个站点会引起安全漏洞。
​	3.这种方法只适用于 Cookie 和 iframe 窗口。



**2.JSONP跨域**

采用jsonp跨域也存在问题：
 1.使用这种方法，只要是个网站都可以拿到b.com里的数据，存在安全性问题。需要网站双方商议基础token的身份验证，这里不详述。
2.只能是GET，不能POST。
3.可能被注入恶意代码，篡改页面内容，可以采用字符串过滤来规避此问题。



**3.CORS**

CORS是一个W3C标准，全称是"跨域资源共享"（Cross-origin resource sharing）。
它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。
刚才的例子中，在b.com里面添加响应头声明允许a.com的访问，代码：

`Access-Control-Allow-Origin: http://a.com`

然后a.com就可以用ajax获取b.com里的数据了。

注意：此方法IE8以下完全不支持，IE8-10部分支持。详见caniuse-CORS

详细链接：

​	http://www.ruanyifeng.com/blog/2016/04/cors.html



**其它方法**
	HTML5的postMessage方法
	window.name
	location.hash



参考链接：

​	浏览器的同源策略（MDN）：https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy

​	同源策略、跨域解决方案（博客园）https://www.cnblogs.com/rockmadman/p/6836834.html



再学习：思否 [前端常见跨域解决方案（全）](https://segmentfault.com/a/1190000011145364)

