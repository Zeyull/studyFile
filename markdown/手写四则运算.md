# 手写四则运算

为什么操作小数会出现误差？

浮点数值的最高进度是17位小数，但在进行运算的时候其精确度却远远不如整数；整数在进行运算的时候都会转成10进制； 而java和JavaScript中计算小数运算时，都会先将十进制的小数换算到对应的二进制，一部分小数并不能完整的换算为二进制，这里就出现了**第一次的误差**。待小数都换算为二进制后，再进行二进制间的运算，得到二进制结果。然后再将二进制结果换算为十进制，这里通常**会出现第二次的误差**。

所以(0.1+0.2) != 0.3



代码：

```javascript
    //乘
	function multiply(a, b) {
        var cont = 0;
        var a = a.toString();
        var b = b.toString();
        try {
            cont += a.split('.')[1].length;

        } catch (e) {}
        try {
            cont += b.split('.')[1].length;
        } catch (e) {}
        return (Number(a.replace('.', '')) * Number(b.replace('.', ''))) / Math.pow(10, cont);
    }
	//除
    function div(a, b) {
        var cont1 = 0;
        var cont2 = 0;
        var a = a.toString();
        var b = b.toString();
        try {
            cont1 += a.split('.')[1].length;

        } catch (e) {}
        try {
            cont2 += b.split('.')[1].length;
        } catch (e) {}
        var cont = cont2 - cont1;
        return (Number(a.replace('.', '')) / Number(b.replace('.', ''))) / Math.pow(10, cont);
    }
	//加
    function add(arg1, arg2) {
        var r1, r2, m;
        try {
            r1 = arg1.toString().split(".")[1].length
        } catch (e) {
            r1 = 0
        }
        try {
            r2 = arg2.toString().split(".")[1].length
        } catch (e) {
            r2 = 0
        }
        m = Math.pow(10, Math.max(r1, r2))
        return (multiply(arg1,m) + multiply(arg2,m)) / m;
    }
	//减
    function sub(a, b){
        var r1, r2, m;
        try {
            r1 = a.toString().split(".")[1].length
        } catch (e) {
            r1 = 0
        }
        try {
            r2 = b.toString().split(".")[1].length
        } catch (e) {
            r2 = 0
        }
        m = Math.pow(10, Math.max(r1, r2))
        return (multiply(a,m) - multiply(b,m)) / m;
    }
//加与减用到了乘法函数，这样修复了直接用*符号的精度问题

之后可以把方法挂载到原型中，挂载后记得修改加法和减法里面的乘法函数
举例：
	Number.prototype.div = function (arg){  
		return accDiv(this, arg);
	}
```



还有一种解决方法：

​	比较常用的办法，toFixed()，toFixed() 方法可把 Number 四舍五入为指定小数位数的数字。在我们计算的结果后面加上这个方法就OK了；但是对精度会有一丝影响，如果精度要求不高的话推荐使用。



参考：	https://blog.csdn.net/liaodehong/article/details/51558292

​				https://blog.csdn.net/Jhno99/article/details/108009947?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-7&spm=1001.2101.3001.4242